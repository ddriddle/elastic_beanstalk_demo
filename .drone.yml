pipeline:
  build:
    image: python:2.7
    commands:
      - pip install pep8
      - pep8 --ignore=E501 mysite
      - pip install awscli
      - aws ecr get-login --region us-east-2
      - aws sts get-caller-identity
      - export PASSWORD=`aws ecr get-login --region us-east-2 | sed 's/docker login -u AWS -p //;s_ none https://617683844790.dkr.ecr.us-east-2.amazonaws.com__'`
      - export
      - export
  s3:
    image: plugins/s3
    region: us-east-2
    bucket: drone-us-east-2-617683844790
    source: aws/Dockerrun.aws.json
    target: django-app-test/develop.json
    strip_prefix: aws/Dockerrun.aws.json
  docker:
    registry: https://617683844790.dkr.ecr.us-east-2.amazonaws.com
    username: AWS
    password: "$PASSWORD"
    image: plugins/ecr
    repo: 617683844790.dkr.ecr.us-east-2.amazonaws.com/django-app-test
    tags:
      - latest
      - 1.0.1
      - 1.0
